<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Echo Coffee</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="top">

        <div class="widthWrap widest">
            <h1>2902 N 68th St <br />Scottsdale, AZ 85251</h1>
            <h2>(480) 422-4081</h2>
        </div>

    </div>
    <div id="mastHead">
        <div id="mastHeadContent">
            <!--           <div id="logo"></div>-->
            <h1>
               
           </h1>
        </div>

    </div>
    <nav>
        <div class="widthWrap widest">
            <ul>links
                <li></li>
            </ul>
        </div>
    </nav>
    <div id="posts" class="widthWrap widest">
        <p id="loading">Loading posts...</p>
    </div>
    <!--Give us some breathing room just to test parallaxing-->
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <script>
        var xmlhttp = new XMLHttpRequest();
        var postURL = "http://chuckdries.com/blog/wp-json/wp/v2/posts";
        var mediaBaseURL = "http://chuckdries.com/blog/wp-json/wp/v2/media";
        xmlhttp.addEventListener("load", loadPosts); //event listener
        xmlhttp.open("GET", postURL); //load the master events list
        xmlhttp.send();
        var postList = new Array;

        function loadPosts() { //triggers when we get the master events list back
            postList = JSON.parse(this.responseText);


            for (post in postList) {

                //http://stackoverflow.com/questions/14004117/create-div-and-append-div-dynamically
                var postDiv = document.createElement('div');
                //var eventContain = 
                postDiv.id = "p" + postList[post].id;
                postDiv.className = 'post';
                document.getElementById("posts").appendChild(postDiv);
                document.getElementById("p" + postList[post].id).innerHTML = "<div id=\"image-" + postDiv.id + "\" class = \"postImage\" </div> <h3 class=\"postTitle\">" + postList[post].title.rendered + "</h3> <p class=\"postContent\">" + postList[post].content.rendered + "</p>";

            }
            listenForMedia();
        }

        function listenForMedia() {
            xmlhttp.removeEventListener("load", loadPosts);
            var xmlHTTPMediaLoaders = [];
            for (post in postList) {
                var mediaURL = mediaBaseURL + "/" + postList[post].featured_image;
                xmlHTTPMediaLoaders.push(new XMLHttpRequest());
                xmlHTTPMediaLoaders[post].addEventListener("load", loadImages);
                xmlHTTPMediaLoaders[post].open("GET", mediaURL); //load the master events list
                xmlHTTPMediaLoaders[post].send();
                console.log("mediaURL " + mediaURL);

            }

        }

        function loadImages() {
            var imagesList = JSON.parse(this.responseText);
            console.log(imagesList);
            console.log("post " + post);
            for (post in postList) {
                var imageID = postList[post].featured_image;
                if (imagesList.id == imageID) {
                    var postDiv = document.getElementById("p" + postList[post].id);
                    var imageDiv = document.getElementById("image-" + postDiv.id);
                    var backgroundURL = imagesList.source_url;
                    console.log(backgroundURL);
                    imageDiv.style.backgroundImage = "url('" + backgroundURL + "')"
                }
            }
        }
    </script>
</body>

</html>